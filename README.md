# Dagui

A library for efficiently rendering GUIs for node graphs with OpenGL and Vulkan backends in C++.

## License 

Dagui is BSD licensed but contains LGPL components.
The understanding is that linking to these components is allowed as long as users of the library are furnished with their source code and rights to reverse engineer for debugging purposes.

## Release schedule

This library is developed in my spare time for fun.  As such, there is no release schedule except to say when I deem it ready.  Its primary purpose is to serve as the GUI for another side project, so I am not overly concerned by timing of a release.

### 20250827
We have hit Prototype1, rendering of a Widget tree, namely a Label with a face and some text.
Next up, Prototype2 with layout and more complex Widgets.

### 20250831
We are removing the dependency on GLUT.

## Collaboration

Pull requests will be allowed at some point. There will be a coding style and probably automated linting which could be a barrier to contribution.

## Dependencies 

* C++17 compiler (gcc 9.4+, clang16+, Apple clang 12+, Visual Studio 2017+)
* Lua-5.4.x for the declarative format
* gtest for automated testing
* gmock to allow mocking in tests
* benchmark for microbenchmarking
* CMake 3.16+ for the build system
* VulkanSceneGraph for integration demos
* freetype for text rasterisation
* pango for text layout including underlining
* glfw for the OpenGL text, renderer demos
* glew for OpenGL support beyond version 1.1 on Windows
* md4c for markdown parsing
* svgpp for SVG parsing
* [dagbase](https://github.com/triblatron/dagbase) for
  * A Lua interface
  * A ConfigurationElement
  * Format agnostic streams
  * A DebugPrinter that produces nice idented output for trees
  * A VectorMap that is more efficient than std::map for certain cases, especially when we know the number of elements in advance
    * This has been benchmarked
  * A root class 
* [dag](https://github.com/triblatron/dag) for
  * basic features such as streams.
  * the node graph support
    * node base class
    * ports
    * nested graphs
    * solving dependencies
    * evaluation
* math library with 2D, 3D vectors and 4x4 matrices
  * required to do translation and rotation in one matrix multiplication
  * required to create an Orthographic projection
* Packages for Linux Debian based
```bash
sudo apt-get install g++ cmake make libfreetype-dev libpango1.0-dev liblua5.4-dev git libglew-dev libglfw3-dev libglm-dev
```
* Packages from Linux Red Hat based
```bash
su
dnf config-manager --enable devel
dnf install freetype-devel lua-devel
exit
```
## Build instructions 
Note that dag, dagbase, md4c and svgpp are git submodules and will eventually all be built at the same time as dagui.

### Linux
```bash
  git clone https://github.com/triblatron/dagui
  mkdir dagui_build && cd dagui_build
  cmake -S ../dagui -B . -DCMAKE_INSTALL_PREFIX=../dagui_install
  make
  make install
  cd ../dagui_install
  source setup.sh
  DaguiTest
```

### Windows 
```bat
git clone https://github.com/triblatron/dependencies-x64-windows-vc17
git clone https://github.com/triblatron/dagui
mkdir dagui_build
cd dagui_build
cmake -C ..\dagui\Automation\Build\InitialCacheVisualStudio.txt -S ..\dagui -B . -DCMAKE_INSTALL_PREFIX="..\dagui_install"  -A x64 -DCMAKE_PREFIX_PATH="\path\to\dependencies-x64-windows-vc17\"
cmake --build . --target install --config Release
cd ..\dagui_install
setup
DaguiTest
```
* Note that the -A argument must precede the -DCMAKE_PREFIX_PATH otherwise dependencies will not be found.
* Note that \path\to\dependencies-x64-windows-vc17 is the path to the dependencies on your system
* Note that you may have to add a -G <generator> where <generator> is something like "Visual Studio 15 2017"
* Note that the -A x64 is mandatory because we don't support 32bit platforms.
* Note that as of 20250308, the dagbase submodule of dagui has been moved to ThirdParty/dag/thirdparty/dagbase, and may be necessary to configure and generate or reopen the solution in Visual Studio to get a correct build
### macOS Common Dependencies
```bash
brew install googletest
brew install google-benchmark
brew install cmake
brew install gcc
brew install freetype
brew install lua
brew install glfw
```
* Note that OpenGL is included as part of the developer SDK.
### macOS X 10.15 Catalina Intel
```bash
git clone https://github.com/triblatron/dagui
mkdir dagui_build && cd dagui_build
cmake -S ../dagui -B . -DCMAKE_INSTALL_PREFIX=../dagui_install -DCMAKE_OSX_DEPLOYMENT_TARGET=10.15 -DCMAKE_BUILD_TYPE=Release
make
make install
cd ../dagui_install
source setup.sh
DaguiTest
```
* This generates UNIX makefiles by default but other build systems can be generated by varying the argument to cmake -G.
* Note that Xcode cannot be installed because of the system requirements for a more modern version of macOS.
### macOS 15.1 Sequoia Apple Silicon
```bash
git clone https://github.com/triblatron/dagui
mkdir dagui_build && cd dagui_build
cmake -S ../dagui -B . -DCMAKE_INSTALL_PREFIX=../dagui_install -DCMAKE_BUILD_TYPE=Release
make
make install
cd ../dagui_install
source setup.sh
DaguiTest
```
* Note that this generates UNIX makefiles, but it is possible to generate other build systems by varying the argument to -G.
  * e.g. -G Xcode 

## Known working platforms
* Ubuntu 20.04.6 LTS x64 gcc 9
  * Requires buliding Lua from source [triblatron/lua](https://github.com/triblatron/lua)
* Ubuntu 22.04 LTS x64 gcc 11.4.0
* Ubuntu 24.04 LTS x64 gcc 13
* Windows 10 Home Version	10.0.19045 Build 19045 Visual Studio Community 2022 17.13.2
* Windows 11 Home 22631.3880 23H2 Visual Studio Community 2017 16.9.65
* Windows 11 Home 22631.3880 23H2 Visual Studio Community 2019 16.11.39
* Windows 11 Home 22631.3880 23H2 Visual Studio Community 2022 17.10.0
  * requires [triblatron/dependencies-x64-windows-vc17](https://github.com/triblatron/dependencies-x64-windows-vc17)
```cmd
git clone https://github.com/triblatron/dependencies-x64-windows-vc17
```
* Ubuntu 22.04.4 LTS x64 on WSL 2 gcc 11.4.0
* Raspberry Pi 5 Raspian 12 aarch64 gcc 12.2

To qualify as working, a platform must:
* provide at least the mininum version of each dependency in its package manager or build from source
* build with no warnings in the dagui code when compiled with -Wall and -Wextra
* pass all the tests
  * unit tests
  * integration tests
  * performance tests
  * manual usability tests

So far, there are only unit tests but that will change in time.

Eventually, there will be automated integration tests that typically assert the presence of particular widgets and calls of event handlers etc.

There will also be automated performance tests that render to texture as a proxy for the screen.  Alongside these will be microbenchmarks that measure performance of various idioms used to implement the library.

Finally, there will be manual usability tests that require running the full system and a tester with some UX experience.

## Known failing platforms
none

## Caveats
For some reason no tests are found on Windows unless we have an explicit main().  This is despite not needing one in other projects.  The issue seems to be related to order of linking libraries but is complicated by cmake or visual studio not honouring the order given in the CMakeLists file.
This has been fixed by tweaking the order in the CMakeLists.txt, which now ends up in Visual Studio.
It is necesary to build benchmark from source to make a successful build on VS2017 and VS2019

## Tips
* SWIG xml mode works only if we %define DAGUI_API %enddef, otherwise it just generaates code tags instead of the parse tree.
* If a library contains a main, it seems that the target_include_directories() for the intended target that has that same main source will be ignored.
  * This leads to includes not being found by the compiler, because they are not passed to the compile line by cmake.
* If you encounter a "not our ref" error mentioning "dag" from git, try:
```bash
git pull
git add ThirdParty/dag
git commit
git pull --recurse-submodules
```
from the dagui checkout directory.
Something similar might work for dagbase, but has not been tested.
* Note that this is a local commit, not a push.
